function openCommentFlagsPopup(e){var t=$("#commentFlagPopup"),a=$("#commentFlag_"+e);a.hasClass("flagged")?(t.addClass("displayNone"),$("#commentFlagSuccessPopup").addClass("displayNone")):(a.addClass("visible").append(t),t.hasClass("displayNone")&&(t.removeClass("displayNone"),$("#commentFlagSuccessPopup").addClass("displayNone")),t.attr("data-comment-id",e))}function investing_GetProChartObject(e){return-1!=navigator.appName.indexOf("Microsoft")?document.getElementsByName(e)[0]:$("embed[AdvinionPro="+e+"]")[0]}function setErrorMsg(e,t){$("#dialog-attach-chart_"+e+" #dialog-attach-chart-content").append(t),$("#amsg_"+e).append("Get Flash")}function isNewChart(e){return $("#commentBox_"+e+"_imgDiv img").attr("src")?($("#replaceChart_"+e+"_confirm").prev().removeClass("genToolTip"),$("#replaceChart_"+e+"_confirm").removeClass("displayNone").show(),!1):!0}function addTooltipClass(e){$(e).removeClass("genToolTip").addClass("genToolTip")}function openChartPopup(e,t){showPopup("dialog-attach-chart_"+t,!0),$("#replaceChart_"+e+"_confirm").addClass("displayNone").hide(),addTooltipClass($("#replaceChart_"+e+"_confirm").prev()),$("#attachTo"+t).val(e);var a=$("#attchChartBtn_"+t);if(flashImageDivId=e,""==$("#dialog-attach-chart_"+t+" #dialog-attach-chart-content").html()){var n;document.old_write=document.write,document.write=function(e){n=$(e)},CreateAdvinionProfessionalChartExInvesting(o1,626,460,null,null,t)?(a.show(),$("#dialog-attach-chart_"+t+" .content #dialog-attach-chart-content").html(n)):($("#searchText_"+e).attr("disabled","disabled"),a.hide()),document.write=document.old_write}else $("#chart_title_"+t).data("extraData")&&setTimeout(function(){var e=investing_GetProChartObject(t);e.SetExtraData($("#chart_title_"+t).data("extraData")),e.SetDecimalPlaces($("#chart_title_"+t).data("decimal")),e.SetTimeScaleControls($("#chart_title_"+t).data("candles"),$("#chart_title_"+t).data("candles")),e.ChangeSymbolNoPush($("#chart_title_"+t).data("strMarket"),$("#chart_title_"+t).data("pair_id"),$("#chart_title_"+t).data("strSymbolName")),$("#chart_title_"+t).html($("#chart_title_"+t).data("strSymbolName"))},2e3);setTimeout(function(){a.attr("disabled",!1)},2500),$("#dialog-attach-chart_"+t).center()}function OnShareScreenshot(e,t){var a=investing_GetProChartObject(e);$("#commentBox_"+t+"_imgDiv").css("display","block"),a.ShareImage(),$("#commentButton_"+t).fadeOut(),hidePopup("dialog-attach-chart_"+e)}function MakeSure(e){return window[_0x41bb[1]](e[_0x41bb[0]](22,47))}function Share_Callback(e,t){var a=flashImageDivId,n=MakeSure(t);$("#attach_"+a).addClass("selected"),$.post("/comments/Service/uploadCommentChart",{img:t,md5:n}).done(function(e){if("ERROR"!=e){var t=commentImagesPath+e;$("#commentBox_"+a+"_img").attr("src",t),$("#commentBox_"+a+"_img").attr("imgName",e),$("#commentBox_"+a+"_imgDiv").removeClass("chartPreview").addClass("chartImg"),$("#dialog-attach-chart_"+a).css({display:"none"}),$("#commentButton_"+a).fadeIn()}})}function openDeletePopup(e){$("#deleteChart_"+e+"_confirm").removeClass("displayNone")}function deleteChart(e){$.post("/comments/Service/deleteCommentChart",{img:$("#commentBox_"+e+"_img").attr("imgName")}),$("#deleteChart_"+e+"_confirm").addClass("displayNone"),$("#commentBox_"+e+"_imgDiv .deleteChartOverlay").attr("style",""),$("#deleteChart_"+e).attr("style",""),reStateImg(e)}function cancelChart(e){$("#deleteChart_"+e+"_confirm").addClass("displayNone")}function cancelReplaceChart(e){$("#replaceChart_"+e+"_confirm").addClass("displayNone"),addTooltipClass($("#replaceChart_"+e+"_confirm").prev())}function reStateImg(e){$("#commentBox_"+e+"_img").attr("src",""),$("#commentBox_"+e+"_imgDiv").removeClass("chartImg").addClass("chartPreview"),$("#commentBox_"+e+"_imgDiv").css("display","none"),$("#attach_"+e).removeClass("selected")}function showHideBigImage(e){bigImgDivId="#commentBigChart"+e,smallImgDivId="#commentSmallChart"+e,$(bigImgDivId).hasClass("displayNone")?($(smallImgDivId).addClass("displayNone"),$("#commentText-"+e).removeClass("withImage"),$(bigImgDivId).removeClass("displayNone"),$(bigImgDivId).fadeTo("normal",1)):$(bigImgDivId).fadeOut("normal",function(){$(bigImgDivId).addClass("displayNone"),$("#commentText-"+e).addClass("withImage"),$(smallImgDivId).removeClass("displayNone")})}function attachChart(e,t){var a=$("#attachTo"+e).val();$("#commentBox_"+a+"_imgDiv img").attr("src")&&deleteChart(a),OnShareScreenshot(e,a);var n=$("#chart_title_"+e).data("pair_id");"undefined"==typeof pairId&&(n=t),$("#commentBox_"+a).data("chart_pairid",n)}function setFocusOnPostButton(e){$("#commentBox_"+e).val()&&$("#commentBox_"+e).val().length<=1e3?($("#post_"+e).removeClass("disabledWhite").addClass("orange"),$("#attach_"+e).addClass("selected")):($("#post_"+e).removeClass("orange").addClass("disabledWhite"),$("#attach_"+e).removeClass("selected"))}function CreateAdvinionProfessionalChartExInvesting(e,t,a,n,o,i){var s="AdvinionPro"+gid,l=ADVINION_Internal_GenrateFlashVars(e);if(gid++,null==t&&(t="300px"),null==a&&(a="300px"),null==o&&(o="#FFFFFF"),hasProductInstall&&!hasRequestedVersion){var c=1==isIE?"ActiveX":"PlugIn",r=window.location;document.title=document.title.slice(0,47)+" - Flash Player Installation";var d=document.title;AC_FL_RunContent("src",strAdvinionFlashFolder+"playerProductInstall","FlashVars","MMredirectURL="+r+"&MMplayerType="+c+"&MMdoctitle="+d,"width","100%","height","100%","align","middle","id",s,"AdvinionPro",i,"quality","high","bgcolor","#B7D2FF","name",i,"allowScriptAccess","sameDomain","type","application/x-shockwave-flash","pluginspage","http://www.adobe.com/go/getflashplayer")}else{if(!hasRequestedVersion){var m='Advinion Charts - Cannot display Professional Chart. This content requires the Adobe Flash Player. <a id="amsg_'+i+'" href=http://www.adobe.com/go/getflash/></a>';return setErrorMsg(i,m),!1}1==n?(AC_FL_RunContent("src",strAdvinionFlashFolder+"AdvinionProfessionalChart_2.63.1","width",t,"height",a,"align","middle","id",s,"AdvinionPro",i,"quality","high","bgcolor",o,"wmode","opaque","name",i,"allowScriptAccess","always","type","application/x-shockwave-flash","flashvars",l,"pluginspage","http://www.adobe.com/go/getflashplayer","allowFullScreen","true"),blnAdvinionScrollViaJS=!0):(AC_FL_RunContent("src",strAdvinionFlashFolder+"AdvinionProfessionalChart_2.63.1","width",t,"height",a,"align","middle","id",s,"AdvinionPro",i,"quality","high","bgcolor",o,"wmode",IS_FF?"direct":"opaque","name",i,"allowScriptAccess","always","type","application/x-shockwave-flash","flashvars",l,"pluginspage","http://www.adobe.com/go/getflashplayer","allowFullScreen","true"),blnAdvinionScrollViaJS=!IS_FF)}return!0}function strip(e){var t=document.createElement("DIV");return t.innerHTML=e,t.textContent||t.innerText}function calculateLimit(e,t,a){var n=$(e+t).val().length,o=parseInt(a)-parseInt(n);$(e+t+"_feedback").html(o),0>o?($(e+t+"_feedback").addClass("redFont"),$("#post_"+t).removeClass("orange").addClass("disabledWhite"),$("#attach_"+t).removeClass("selected")):($(e+t+"_feedback").removeClass("redFont"),$("#commentBox_"+t).val()?($("#post_"+t).removeClass("disabledWhite").addClass("orange"),$("#attach_"+t).addClass("selected")):($("#post_"+t).removeClass("orange").addClass("disabledWhite"),$("#attach_"+t).removeClass("selected")),o>100?$(e+t+"_feedback").addClass("displayNone"):$(e+t+"_feedback").removeClass("displayNone"))}function close_comment_notification(e){$(e.parentElement).fadeOut("fast")}function avoidEmptyCommentSubmitError(e){$("#post_"+e).on("click",function(t){var a=$("#commentBox_"+e);(""==a.val()||a.val()>1e3||a.val()==a.text())&&hideOverlay()})}function updateCommentsDates(e){$("div[data-comment-id] .commentBody").each(function(){var t=$(this),a=parseDateUTC($("span[comment-date]",t).attr("comment-date")),n=$("span[comment-date]",t).attr("comment-date-formatted"),o=e.FormatDateTime(a,n);$("span[comment-date]",t).html(o.toString())})}function parseDateUTC(e){var t=/^(\d{4})-(\d{2})-(\d{2}) (\d{2}):(\d{2}):(\d{2})$/,a=t.exec(e);return a?new Date(Date.UTC(a[1],a[2]-1,a[3],a[4],a[5],a[6])):null}function processCommentsRetrieve(e,t){var a=$(t);return a.children(":first")&&a.children(":first").children(":last-child").remove(),e.callback=function(e){setTimeout(function(){a.siblings(".commentsWrapper").append('<div class="displayNone"><hr />'+e+"</div>"),a.children(":last-child").remove(),a.siblings(".commentsWrapper").children(":last-child").fadeIn(),a.remove()},1e3)},e}function processRepliesRetrieve(e,t){var a=$(t),n=$("#autoRefreshEnabled");return a.children(":last-child").remove(),e.parent=a.parents("[data-comment-id]:first").data("comment-id"),e.callback=function(t){setTimeout(function(){a.before('<div class="displayNone">'+t+"</div>"),a.children(":last-child").remove(),a.prev().fadeIn(),a.remove(),n.length>0&&n.trigger("autoRefresh-NewComment",[t,e.parent])},1e3)},e}function assignCommentEvents(e,t,a,n){$("#commentBox_"+t+"_wrapper").click(function(){$("#commentBox_"+t).focus()}),$("#commentBox_"+t).each(function(){$(this).data("default-value",$(this).val())}).focus(function(){$(this).val()==$(this).data("default-value")&&$(this).val(""),setFocusOnPostButton(t)}).blur(function(){var e=/^\\+$/.test($.trim($(this).val()));(""==$.trim($(this).val())||e)&&$(this).val($(this).data("default-value")),setFocusOnPostButton(t)}).on("keydown",function(e){var t=12,a=$(this).val().split("\n").length;13==e.keyCode&&t>a&&$(this).attr("rows",a+1)}).on("keyup",function(e){setFocusOnPostButton(t),calculateLimit("#commentBox_",t,1e3)}),a.enablePostBtn($("#post_"+t)),$("a.reply").live("click",function(){var e,t,n,o=$("#replyBoxTemplate").html(),i=$(this).parent(),s=i.parents("[data-comment-id]:first");if(!s.data("reply-box-visible")){var l;s.data("reply-box-visible",1),s.hasClass("commentReply")?(n=s.parents("[data-comment-id]:first").data("comment-id"),l=n+"_"+$(this).data("real-parent-id")):(n=s.data("comment-id"),l=n),o=o.replace(/ADD_ID_HERE/g,l),i.after('<div class="displayNone replyTemplate">'+o+"</div>"),i.next().fadeIn(),e=i.next(),t=$('textarea[id^="commentBox_"]',e);var c=t.attr("data-real_parent_id");t.focus(function(){setFocusOnPostButton(c)}).blur(function(){setFocusOnPostButton(c)}).on("keyup",function(e){setFocusOnPostButton(c),calculateLimit("#commentBox_",c,1e3)}),t.data("default-value",t.val()).val("").blur(function(){var e=this,t=/^\\+$/.test($.trim($(this).val()));setTimeout(function(){(t||""==$.trim($(e).val())&&!$(e).is(":focus"))&&$(e).val($(e).data("default-value"))},300)}).click(function(){a.validate($(this).val())||$(this).val("")}).data("comment-parent-id",n),a.enablePostBtn($("#post_"+l))}return $("textarea",i.next()).focus().val(""),!1}),$('a[data-action="listComments"], a[data-action="listReplies"]['+t+"]").live("click",function(){var e=$(this).data("action"),n={action:e},o=$(this);switch(n.section=$("#commentBox_"+t).data("comment-section-id"),n.content=$("#commentBox_"+t).data("comment-content-id"),n.author=$("#commentBox_"+t).data("comment-author-id"),e){case"listReplies":n=processRepliesRetrieve(n,this);break;case"listComments":n=processCommentsRetrieve(n,this)}return o.children(":last-child").after($("#commentMoreLoadingTemplate").html()),a.list(n),!1});var o=$("#comment-guidelines-container"+t);$("#comment-guidelines-anchor"+t).click(function(){o.is(":visible")||(o.show().center().css({left:"",bottom:"auto"}),bindEscape("#comment-guidelines-container"+t,".closePopup"),$("#agreementBox_"+t).addClass("displayNone"),$("#generalOverlay").removeClass("displayNone").show())}),$(e).mouseup(function(e){($(e.target).parents().is("#comment-guidelines-container"+t)||$(e.target).is("#comment-guidelines-anchor"+t)||$(e.target).is("#generalOverlay")||$(e.target).is(".hoverboxWithShadow"))&&!$(e.target).is("#comment-guidelines-close")||($("#agreementBox_"+t).addClass("displayNone"),$("#comment-guidelines-container"+t).removeClass("firstPending").hide(),$("#generalOverlay").addClass("displayNone"))}),$(".closePopup").on("click",function(){$(this).parent().hasClass("firstPending")&&$(".generalOverlay").hide(),$.ajax({url:"/comments/Service/clearSession",type:"get",data:{action:"clearSession",content:t},success:function(e){}})})}$(document).ready(function(){$("body").click(function(){$("#commentFlagPopup").addClass("displayNone").attr("data-comment-id","").parent().removeClass("visible"),$("#commentFlagSuccessPopup").addClass("displayNone").attr("data-comment-id",""),$("input","#commentFlagPopup").prop("checked",!1),$("#commentFlagPopupSubmit").addClass("disabled")}),$("#commentFlagPopup").on("click",function(e){e.stopPropagation()}),$("#commentFlagSuccessClose").on("click",function(e){$("#commentFlagSuccessPopup").addClass("displayNone")}),$("#commentFlagPopup INPUT").change(function(){var e=$("#commentFlagPopupSubmit");e.removeClass("disabled")}),$("#commentFlagPopupSubmit").on("click",function(e){var t=$("#commentFlagPopup");if(!$(this).hasClass("disabled")){var a=$('input[name="commentFlagType"]:checked',t).val(),n=t.attr("data-comment-id");t.addClass("displayNone"),$('[name="commentFlagType"]',t).prop("checked",!1),$("#commentFlagPopupSubmit").addClass("disabled"),t.attr("data-comment-id",""),$.ajax({url:"/comments/Service/flagComment",type:"post",data:{action:"flagComment",comment:n,flagType:a},success:function(e){if("unauthorized"==e)overlay.overlayLogin();else{$("#commentFlagSuccessPopup").removeClass("displayNone");var t=$("#commentFlag_"+n);t.addClass("flagged").append($("#commentFlagSuccessPopup")),t.attr("data-tooltip",t.attr("data-alternate"))}}})}}),$('[id^="commentFlag_"]').live("click",function(e){var t=$(this).attr("id");t=t.replace("commentFlag_",""),openCommentFlagsPopup(t),e.stopPropagation()})});var _0x41bb=["substr","btoa"];$("#scrollToComments").live("click",function(){$.scrollTo($("#addAComment"),1e3),scroll_up_comments()});var elapsedTimeFormat=function(e,t){function a(e,t,a){var n,o,i,s,l;for(var c in t)if(t.hasOwnProperty(c)){var r=t[c];for(var d in r)if(r.hasOwnProperty(d))if(n=r[d].toString(),o=n.split("-"),o.length>1){if(s=o[0],l=o[1],parseInt(e)>=s&&parseInt(e)<=l)return i=-1!=c.indexOf("X")?c.replace("X",e):c}else if(parseInt(e)==parseInt(n))return i=-1!=c.indexOf("X")?c.replace("X",e):c}}function n(e,n){var i=new Date,s=Math.floor((parseInt(i.getTime())-parseInt(e.getTime()))/1e3),l=0,c=0;return s>=86400?n:60>s?t:3600>s?(l=Math.floor(s/60),a(l,o.minutes,e)):86400>s?(c=Math.floor(s/3600),a(c,o.hours,e)):e}var o=JSON.parse(e);this.FormatDateTime=n},FPcomments=function(e,t,a,n){function o(e){$.ajax({url:"/comments/Service/flag",type:"get",data:{action:"flag",comment:e},success:function(e){},error:function(){setTimeout(function(){o(e)},5e3)}})}function i(e){$.ajax({url:"/comments/Service/list",type:e.method,data:e.data,success:e.callback,error:function(){setTimeout(function(){sendListService(e)},5e3)}})}function s(e){var t={data:{action:e.action,parent:e.parent,section:e.section,content:e.content,author:e.author},callback:e.callback,method:"get"};i(t)}function l(e){var o=$(e).val(),i=$(e).data("real_parent_id"),s=$(e).data("comment-content-id"),p=$("#commentBox_"+i+"_img").attr("src"),h=$("#commentBox_"+s).data("comment-section-id"),v=$("#commentBox_"+s).data("content-author-id"),g=$("#commentBox_"+s).data("content-author-is-local"),f=$("#commentBox_"+s).data("content-title"),_=$("#commentBox_"+s).data("content-url"),C=$(e).data("comment-parent-id"),y=$("[data-comment-id="+C+"]"),b=$("#viewComments_"+s+" .commentsWrapper"),x=$(".showMoreReplies",y),B=$("#post_"+i),I=$("#commentBox_"+s).data("chart_pairid"),P=$("#autoRefreshEnabled"),F=P.length>0;if(c(o)){void 0!=p&&""!=p&&(p=p.replace(a,"")),r(B),m(B);var w={action:"add",isFirstComment:t?1:0,isAgree:!1,section:h,content:s,parent:C,text:o,contentAuthorID:v,contentAuthorIsLocal:g,contentTitle:f,imageName:p,contentURL:_,chartPairId:I};F&&(w.autoRefresh="enabled"),$.ajax({url:"/comments/Service/add",type:"get",data:w,success:function(a){if("unauthorized"==a)overlay.overlayLogin();else if("failed"==a);else if("agreementbox"==a)$("#comment-guidelines-container"+s).addClass("firstPending").show().center().css({left:"",bottom:"auto"}),bindEscape("#comment-guidelines-container"+s,".closePopup"),$("#agreementBox_"+s).removeClass("displayNone"),$("#guidelinesCheckbox"+s).removeAttr("checked"),$("#guidelinesButton"+s).addClass("disabled"),$("#generalOverlay").removeClass("displayNone"),$("#guidelinesButton"+s).unbind("click").bind("click",function(){"checked"==$("#guidelinesCheckbox"+s).attr("checked")&&(r(B),m(B),$("#agreementBox_"+s).addClass("displayNone"),$("#comment-guidelines-container"+s).removeClass("firstPending").hide(),$("#generalOverlay").addClass("displayNone"),w.isAgree=!0,$.ajax({url:"/comments/Service/add",type:"get",data:w,success:function(a){"unauthorized"==a?overlay.overlayLogin():"failed"==a||("pendingmessage"==a?$("#pendingMessage"+s).removeClass("displayNone").show():"undefined"==typeof C?(b.prepend(a),reStateImg(s),t&&$("#viewComments_"+s).prepend("<h3>"+n+"</h3>")):(x.length>0?$("a",x).click():(y.append('<div class="displayNone">'+a+"</div>"),y.children("div:last").fadeIn()),$(e).parents("[data-comment-id]:first").data("reply-box-visible",0),y.find(".replyBoxWrap").remove()),$("#commentBox_"+i+"_img").attr("src",""),$("#commentBox_"+i+"_imgDiv").css({display:"none"}),$(e).val($(e).data("default-value")),$("#commentBox_"+s+"_feedback").html(1e3).addClass("displayNone")),d(B),u(B)},error:function(){setTimeout(function(){l()},5e3)}}))});else{if("pendingmessage"==a)$(".commentNotification").addClass("displayNone").hide(),$("#pendingMessage"+s).removeClass("displayNone").show();else if($(".commentNotification").addClass("displayNone").hide(),"undefined"==typeof C)b.prepend(a),reStateImg(s),F&&P.trigger("autoRefresh-NewComment",[a,"0"]),t&&$("#viewComments_"+s).prepend("<h3>"+n+"</h3>"),t=!1,$("#agreementBox_"+s).addClass("displayNone");else{if(x.length>0)$("a",x).click();else if(F){var o=$('<div class="displayNone">'+a+"</div>"),c=y.find(".js-AutoRefreshItem");c.length>0?c.before(o):(P.trigger("autoRefresh-NewComment",[a,C]),y.append(o)),o.fadeIn()}else y.append('<div class="displayNone">'+a+"</div>"),y.children("div:last").fadeIn();$(e).parents("[data-comment-id]:first").data("reply-box-visible",0),y.find(".commentBoxWrap").parent().remove()}$("#commentBox_"+i+"_img").attr("src",""),$("#commentBox_"+i+"_imgDiv").css({display:"none"}),$(e).val($(e).data("default-value")),$("#commentBox_"+s+"_feedback").html(1e3).addClass("displayNone")}d(B),u(B)},error:function(){setTimeout(function(){l()},5e3)}})}else $(".commentBox_"+s).addClass("error"),hideOverlay(),console.log("Error occured!")}function c(t){var a=/^\\+$/.test(t);return a||""==$.trim(t)||t==$("#commentBox_"+e).data("default-value")||t==$("#commentBox_"+e).data("replyTextarea_default-value")?!1:!0}function r(e){var t=$("#postBtnLoadingTemplate").html();$(e).before(t)}function d(e){$(e).prev().remove()}function m(e){e.unbind("click").click(function(){return!1})}function u(e){e.click(function(){return $(e).hasClass("disabledWhite")||l($("#commentBox_"+e.attr("contentId"))),!1})}this.enablePostBtn=u,this.validate=c,this.flag=o,this.list=s,this.listService=i};